function LightBox(){this.$lightBox=null;this.$content=null;this.$container=null;this.$image=null;this.$cell=null;this.$prevBox=null;this.$nextBox=null;this.$imageBox=null;this.$coverBox=null;this.$listBoxText=null;this.isTouchCapable=false;this.pauseTiming=1;this.timing=3000;this.contentWidth=0;this.nrOfItems=0;this.textPosition=0;this.heightPercent=0.9;this.maxHeight=0;this.listTextHeight=0;this.currentScrollLeft=0;this.currentIndex=0;this.pauseTimerTemporary=false;this.transactionMode="fade";this.create=function(a,e){var d=this;this._setSettings(e);var c='<div class="lightBox" id="lightbox-'+a+'"><div class="hideLightBox icon-close"></div><div class="lightBoxContent"><div class="scrollContainer"></div></div><div class="lightBoxBg"></div></div>';var b=$(c);var f=b.find(".scrollContainer");$('.openLightBox[data-pageguid="'+a+'"]').each(function(){var j=$(d._getCellMarkup());var g=$(this).find(".lightBoxImage");var i=$(this).find(".hiddenLightBoxText");j.find(".coverBox").append(g.clone().removeAttr("style"));j.find(".lightBoxText").html(i.val());var h=j.find(".shareImages");if(d.textPosition==0){h.addClass("toTheRight")}if(j.find(".textAndButton").html()==""){h.addClass("noText")}f.append(j)});this.$lightBox=b;this._setSettingClasses(e);$("body").append(b);this._initConstants();this._initEvents();$(".selectors select").change()};this._setSettings=function(a){this.nrOfItems=a.nrOfItems;this.textPosition=a.textPosition;this.transactionMode=a.fx;this.timing=a.timing;this.pauseTiming=a.pauseTiming;this.color=a.color};this._setSettingClasses=function(a){if(a.textPosition==1){this.$lightBox.addClass("right")}else{if(a.textPosition==2){this.$lightBox.addClass("showOnHover")}else{this.$lightBox.addClass("bottom")}}};this.open=function(a,b){this.$lightBox.fadeIn(200);this._initSizeDependencies();this._loadImage(b)};this._loadImage=function(c){var b=this;if(c<0||c>(this.nrOfItems-1)){c=0}var d=c+1;var a=this.$lightBox.find(".cell:nth-child("+d+")");b._setSrcOnActiveImage(a);b._setSrcNeighborImages(a,d);var e=c*this.contentWidth;this.$content.animate({scrollLeft:e},1,function(){b.$container.css("opacity",1)});this.currentScrollLeft=e;this.currentIndex=c;a.addClass("active");this._adjustListTextWidth(a)};this._changeImage=function(e){this.pauseTimerTemporary=true;var b=this;var g=0;var d=this.currentIndex;if(e){d=d+1;g=parseInt(this.currentScrollLeft)+this.contentWidth}else{d=d-1;g=parseInt(this.currentScrollLeft)-this.contentWidth}if(d>(this.nrOfItems-1)){d=0;g=0}else{if(d<0){d=this.nrOfItems-1;g=this.totalWidth-this.contentWidth}}this.currentIndex=d;var f=d+1;var a=this.$lightBox.find(".cell:nth-child("+f+")");this._setSrcNeighborImages(a,f);if(this.transactionMode=="fade"){this.$container.fadeTo(300,0.01,function(){b.$content.scrollLeft(g);b.currentScrollLeft=g;b._setActiveClassOnCell(a,"fade");b.$container.fadeTo(300,1,function(){b.pauseTimerTemporary=false})})}else{b._setActiveClassOnCell(a,"slide");var c=400;if(b.isTouchCapable){c=300}b.$content.animate({scrollLeft:g},c,function(){b._removeActiveClassOnSiblings(a,"slide");b.pauseTimerTemporary=false});b.currentScrollLeft=g}this._adjustListTextWidth(a);return false};this._initSizeDependencies=function(){this._initHeight();this._initWidth()};this._initHeight=function(){var c=0;if(this.textPosition==0){this.$listBoxText.each(function(){if($(this).height()>c){c=$(this).height()}})}var b=$(window).height();if(c>b*this.heightPercent*2/5){c=b*this.heightPercent*2/5}this.$listBoxText.css({"max-height":b*this.heightPercent*2/5+"px","overflow-y":"auto"});var a=b*this.heightPercent-c;this.$image.css("max-height",a+"px");this.maxHeight=a;var d=($(window).height()-a-c)/2-20;if(d<1){d=1}this.$content.css("margin-top",d+"px")};this._initWidth=function(){this.contentWidth=this.$content.width();this.totalWidth=this.contentWidth*this.nrOfItems;this.$container.width(this.totalWidth);this.$cell.width(this.contentWidth)};this._initConstants=function(){this.$content=this.$lightBox.find(".lightBoxContent");this.$container=this.$lightBox.find(".scrollContainer");this.$image=this.$lightBox.find(".lightBoxImage");this.$cell=this.$lightBox.find(".cell");this.$prevBox=this.$lightBox.find(".prevBox");this.$nextBox=this.$lightBox.find(".nextBox");this.$prevButton=this.$lightBox.find(".prevButton");this.$nextButton=this.$lightBox.find(".nextButton");this.$imageBox=this.$lightBox.find(".imageBox");this.$coverBox=this.$lightBox.find(".coverBox");this.$listBoxText=this.$lightBox.find(".lightBoxText");this.isTouchCapable=$.isTouchCapable();if(this.isTouchCapable){this.transactionMode="scrollLeft";this.pauseTiming=1;this.$content.css("overflow-x","scroll")}};this._initHover=function(){var a=this;this.$prevBox.hover(function(){a.$prevButton.fadeIn(1)},function(){a.$prevButton.fadeOut(1)});this.$nextBox.hover(function(){a.$nextButton.fadeIn(1)},function(){a.$nextButton.fadeOut(1)})};this._initEvents=function(){var a=this;$(window).resize(function(){a._initSizeDependencies();a._loadImage(a.currentIndex)});if(this.pauseTiming!=1){window.setInterval(function(){if(a.pauseTimerTemporary!=true){a._changeImage(true)}},this.timing)}if(!this.isTouchCapable){$(this.$prevBox).click(function(){var b=$(this).hasClass("nextBox");a._changeImage(b)});$(this.$nextBox).click(function(){var b=$(this).hasClass("nextBox");a._changeImage(b)})}else{$(this.$content).swipeend(function(c,d){var b=d.direction=="left";a._changeImage(b)});this.$nextBox.css("display","none");this.$prevBox.css("display","none")}$(document).keydown(function(c){if(c.keyCode==37){var b=false;a._changeImage(b)}if(c.keyCode==39){var b=true;a._changeImage(b)}});this._initTextOnHover();this._initHover()};this._adjustListTextWidth=function(j){var a=j.find(".lightBoxImage");var b=a.attr("data-width");var i=a.attr("data-height");var c=b/i;var e=this.$cell.width();var h=this.maxHeight;var f=e;var d=f/c;if(d>h){f=h*c}if(b<f){f=b}if(this.textPosition==0){j.find("figcaption").width(f)}else{if(this.textPosition==1){var g=(this.$coverBox.width()-f)/2+10;if(g<10){g=10}this.$nextButton.css("right",g+"px");this.$prevButton.css("left",g+"px");console.log(g)}}};this._initTextOnHover=function(){if(this.textPosition==2&&!this.isTouchCapable){this.$imageBox.hover(function(){$(this).find("figcaption").fadeIn(200)},function(){$(this).find("figcaption").fadeOut(300)})}if(this.textPosition==2&&this.isTouchCapable){this.$coverBox.singletap(function(){$(this).closest("figure").find("figcaption").fadeIn(200).addClass("isShown")});this.$imageBox.find(".closeBottom").singletap(function(){$(this).closest("figcaption").fadeOut(200).removeClass("isShown")})}};this._setSrcOnActiveImage=function(a){var b=a.find(".lightBoxImage");var c=b.attr("data-src");b.attr("src",c)};this._setSrcNeighborImages=function(c,g){var d=g-1;var a=g+1;if(g==1){d=this.nrOfItems}else{if(g==this.nrOfItems){a=1}}var f=this.$lightBox.find(".cell:nth-child("+a+")").find(".lightBoxImage");if(f.attr("src")==""){var e=f.attr("data-src");f.attr("src",e)}var b=this.$lightBox.find(".cell:nth-child("+d+")").find(".lightBoxImage");if(b.attr("src")==""){var h=b.attr("data-src");b.attr("src",h)}};this._setActiveClassOnCell=function(a,b){this.$lightBox.find(".cell.active").removeClass("active");a.addClass("active");if(b=="slide"){a.next(".cell").addClass("active");a.prev(".cell").addClass("active")}};this._removeActiveClassOnSiblings=function(a,b){if(b=="slide"){a.next(".cell").removeClass("active");a.prev(".cell").removeClass("active")}};this._getCellMarkup=function(){var a="";a+='<div class="cell">';a+='<figure class="clearfix">';a+='<div class="imageBox clearfix">';a+='<div class="coverBox">';a+='<div class="prevBox"><div class="prevButton icon-arrow-left"></div>&nbsp;</div>';a+='<div class="nextBox"><div class="nextButton icon-arrow-right"></div>&nbsp;</div>';a+="</div>";a+="<figcaption>";a+='<div class="closeBottom icon-close"></div>';a+='<div class="textContent lightBoxText">';a+="</div>";a+="</figcaption>";a+="</div>";a+="</figure>";a+="</div>";return a}};